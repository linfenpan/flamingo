/** By da棕熊 2015/07/17 1.0.0 **/!function(t,n){function e(){this._dones=[],this._fails=[],this._status=0,this._ctx=[]}function r(){var t=arguments,n=t[0];if(t.length>=2)for(var e=[].slice.call(t,1),r=0,i=e.length;i>r;r++){var s=e[r]||{};for(var a in s)n[a]=s[a]}return n}function i(t,n,e){if("attr"==n&&o!=t)s(),l=e(t);else if(l.attr){var r=l,i=p;switch(n){case"fn":i.push(t);break;case"then":if(i.length>0){var u=a(l.attr);u._pt=l,p.push(u),l.fn.push(p),p=[],l=u}break;case"end":if(l._pt){var u=l._pt;delete l._pt,l=u,p=[]}break;case"error":i.length<=0?r.error=t:(i.push(t),r.fn.push(i),p=[])}}}function s(t){var n=p;p.length>0&&(t&&l&&"string"!=typeof n[n.length-1]&&n.push("不通过:"+l.attr),l&&l.fn&&l.fn.push(n),p=[])}function a(t){return{attr:t,fn:[]}}function u(t,n){for(var e,r,i,s=t.fn,a=0,h=s.length;h>a;a++)if(r=s[a].slice(0),!(r.length<=1)){i=r.splice(-1)[0];for(var f=0,c=r.length;c>f;f++){var o,l=r[f];if("function"==typeof l){var o=l(n);if(!o){e=i;break}}}if(e){if("string"==typeof i)break;e=""}else if("object"==typeof i)return u(i,n)}return e?{attr:t.attr,error:e}:!0}function h(){return this instanceof h?this.init():new h}var f={max:function(t,n){return t&&t.length<=n},min:function(t,n){return t&&t.length>=n},notEmpty:function(t){return t&&""!==t.replace(/^\s*|\s*$/g,"")},isEmpty:function(t){return!t||""===t.replace(/^\s*|\s*$/g,"")},url:function(t){return/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(t)},email:function(t){return/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/.test(t)},number:function(t){return!isNaN(Number(t))},"int":function(t){return/^\d+$/.test(t)}};e.prototype={_execute:function(t,n){this._ctx=n;for(var e=0,r=t.length;r>e;e++)t[e].apply(this,n)},resolve:function(){return this._execute(this._dones,arguments),this._status=1,this},reject:function(){return this._execute(this._fails,arguments),this._status=2,this},done:function(t){return this._dones.push(t),1==this._status&&t.apply(this,this._ctx),this},fail:function(t){return this._fails.push(t),2==this._status&&t.apply(this,this._ctx),this},always:function(t){return this.done(t),this.fail(t),this}};var c=1,o="",l={},p=[];h.prototype={init:function(){this._vlist=[],this._map={},this._data={};var t=f;for(var n in t)this.add(n,t[n]);return this},data:function(t,n){if("object"==typeof t){var e=[this._data];e.push.apply(e,arguments),r.apply(this,e)}else if(2==arguments.length)this._data[t]=n;else if(arguments.length<=0)return this._data},clear:function(){this._data={}},add:function(t,n){return this[t]=function(t){var n=t.length-1;return function(){var e=[].slice.call(arguments,0);return this.check("",function(r){var i=e.slice(0,n);return i.unshift(r),t.apply(this,i)}),e.length>n&&this.check("","",e[n]),this}}(n,t),this},define:function(){var t=arguments;if("function"==typeof t[0]){var n="define_func_"+c++;return this.add(n,t[0]),this[n].apply(this,[].slice.call(t,1)),this}},_addItem:function(t){var n=this._map,e=n[t];return e||(e=n[t]=a(t),this._vlist.push(e)),e},start:function(t,n){s(!0),"object"==typeof t&&(n=t,t=!1),n=r({},this._data,n||{});for(var i,a,h,f=[],c=new e,o=this._vlist,l=0,p=o.length;p>l;l++)if(a=o[l],h=a.attr,n[h]&&(i=u(a,n[h]),i!==!0&&(f.push(i),!t)))return c.reject(i);return f.length>0?c.reject(f):c.resolve()},error:function(t){return this.check("","",t),this},then:function(){return i("","then"),this},end:function(){return i("","end"),this},check:function(t,n,e){if(t){var r=this;i(t,"attr",function(t){return r._addItem(t)})}return n&&i(n,"fn"),e&&i(e,"error"),this},valid:function(t){var n=[].slice.call(arguments,0),e=!1;"object"==typeof t?n.splice(0,1):t={},"boolean"==typeof n[n.length-1]&&(e=n[n.length-1]),"object"==typeof n[0]&&n[0].length>0&&(n=n[0]);for(var r,i=0,s=n.length;s>i;i++)r=n[i],t[r]=t[r]||this._data[r];return this.start(e,t)}},t[n||"PipeValid"]=h}(window,window.PIPEVALID);
